@using DublinBikesBlazor.Models

<div class="card shadow-sm">
    <div class="card-header bg-accent text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0 d-flex align-items-center gap-2">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z" stroke="currentColor" stroke-width="1.4"/><path d="M11 11h2v4h-2zM11 7h2v2h-2z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Station Details
        </h5>
        <button class="btn btn-sm btn-light" @onclick="OnClose" aria-label="Close detail panel">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
        </button>
    </div>
    <div class="card-body">
        <h4 class="card-title">@Station.Name</h4>
        <p class="text-muted mb-3">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="vertical-align:middle; margin-right:6px"><path d="M12 21s-6-4.35-6-10A6 6 0 1 1 18 11c0 5.65-6 10-6 10z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            @Station.Address
        </p>

        <div class="mb-3">
            <span class="badge @(Station.Status == "OPEN" ? "bg-success" : "bg-danger") fs-6">
                @Station.Status
            </span>
        </div>

        <dl class="row mb-0">
            <dt class="col-sm-6">Station Number:</dt>
            <dd class="col-sm-6">#@Station.Number</dd>

            <dt class="col-sm-6">Total Bike Stands:</dt>
            <dd class="col-sm-6">@Station.BikeStands</dd>

            <dt class="col-sm-6">Available Bikes:</dt>
            <dd class="col-sm-6">
                <strong class="text-success">@Station.AvailableBikes</strong>
            </dd>

            <dt class="col-sm-6">Available Stands:</dt>
            <dd class="col-sm-6">@Station.AvailableBikeStands</dd>

            <dt class="col-sm-6">Occupancy:</dt>
            <dd class="col-sm-6">
                <div class="progress" style="height: 25px;" role="progressbar"
                     aria-label="Station occupancy"
                     aria-valuenow="@Station.Occupancy"
                     aria-valuemin="0"
                     aria-valuemax="100">
                    <div class="progress-bar @GetOccupancyColor()"
                         style="width: @(Station.Occupancy)%">
                        @Station.Occupancy.ToString("F1")%
                    </div>
                </div>
                <small class="text-muted">@Station.AvailableBikes of @Station.BikeStands bikes in use</small>
            </dd>

            <dt class="col-sm-6">Coordinates:</dt>
            <dd class="col-sm-6">
                    <a href="https://www.google.com/maps?q=@Station.Latitude,@Station.Longitude"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="text-decoration-none"
                   aria-label="View location on Google Maps">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" style="vertical-align:middle; margin-right:6px"><path d="M12 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" stroke="currentColor" stroke-width="1.2"/><path d="M12 2C8 2 4 5 4 10c0 6 8 12 8 12s8-6 8-12c0-5-4-8-8-8z" stroke="currentColor" stroke-width="1.2"/></svg>
                        @Station.Latitude.ToString("F6"), @Station.Longitude.ToString("F6")
                </a>
            </dd>

            <dt class="col-sm-6">Last Updated:</dt>
            <dd class="col-sm-6">
                <small class="text-muted">
                    @Station.LastUpdateLocal.ToString("dd MMM yyyy HH:mm:ss")
                </small>
            </dd>
        </dl>
    </div>
    <div class="card-footer">
        <div class="d-grid gap-2">
            <button class="btn btn-warning" @onclick="() => OnEdit.InvokeAsync(Station)">
                <i class="bi bi-pencil"></i> Edit Station
            </button>
            <button class="btn btn-danger" @onclick="() => OnDelete.InvokeAsync(Station.Number)">
                <i class="bi bi-trash"></i> Delete Station
            </button>
        </div>
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public StationDto Station { get; set; } = null!;

    [Parameter]
    public EventCallback OnClose { get; set; }

    [Parameter]
    public EventCallback<StationDto> OnEdit { get; set; }

    [Parameter]
    public EventCallback<int> OnDelete { get; set; }

    private string GetOccupancyColor()
    {
        if (Station.Occupancy < 30)
            return "bg-success";
        else if (Station.Occupancy < 70)
            return "bg-warning";
        else
            return "bg-danger";
    }
}
